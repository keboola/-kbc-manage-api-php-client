sudo: required

services:
  - docker

script:
 - echo $PHP_VERSION
 - docker-compose build --build-arg PHP_VERSION=$PHP_VERSION release
 - docker tag keboola/manage-api-tests:latest keboola/manage-api-tests:release$PHP_VERSION
 - docker network create connection_api-tests
 - docker-compose run --rm release composer ci
 - docker images

jobs:
  include:
    - stage: build and tests
      name: PHP7.1
      env: PHP_VERSION=
    - name: PHP7.2
      env: PHP_VERSION=7.2
    - name: PHP7.3
      env: PHP_VERSION=7.3
    - name: PHP7.4
      env: PHP_VERSION=7.4
    - name: PHP8.0
      env: PHP_VERSION=8.0
